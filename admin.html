<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.M.J.J.K - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a202c; color: white; }
        .form-section, .backup-section { background-color: #2d3748; padding: 2rem; border-radius: 0.5rem; margin-bottom: 2rem; }
        .form-input { background-color: #4a5568; border: 1px solid #718096; color: white; border-radius: 0.375rem; }
        .form-input::-webkit-calendar-picker-indicator { filter: invert(1); }
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .btn-primary { background-color: #4299e1; color: white; }
        .btn-primary:hover { background-color: #2b6cb0; }
        .btn-danger { background-color: #e53e3e; color: white; }
        .btn-danger:hover { background-color: #c53030; }
        .btn-secondary { background-color: #718096; color: white; }
        .btn-secondary:hover { background-color: #4a5568; }
        .btn-success { background-color: #38a169; color: white; }
        .btn-success:hover { background-color: #2f855a; }
        #data-display { max-height: 400px; overflow-y: auto; background-color: #1a202c; padding: 1rem; border-radius: 0.5rem; border: 1px solid #4a5568; }
        .url-input-container { display: flex; align-items: center; border: 1px solid #718096; border-radius: 0.375rem; background-color: #4a5568; }
        .url-base { background-color: #2d3748; padding: 0.5rem; white-space: nowrap; border-right: 1px solid #718096; }
        .url-final-input { border: none; outline: none; padding: 0.5rem; width: 100%; background-color: transparent; color: white; }
    </style>
</head>
<body class="p-8 font-sans">

    <h1 class="text-4xl font-bold text-center mb-8">Painel de Administração - A.M.J.J.K</h1>

    <div class="backup-section text-center">
        <h2 class="text-2xl font-bold mb-4">Backup e Restauração</h2>
        <p class="text-sm text-gray-400 mb-4">Faça backup de todos os dados ou restaure a partir de um arquivo .json.</p>
        <div class="flex justify-center space-x-4">
            <button onclick="backupData()" class="btn btn-success">Fazer Backup</button>
            <button onclick="triggerRestore()" class="btn btn-danger">Restaurar Backup</button>
            <input type="file" id="restore-file-input" class="hidden" accept=".json" onchange="restoreData(event)">
        </div>
    </div>

    <div class="mb-8">
        <label for="section-select" class="block mb-2 text-lg font-medium">Selecione a área para gerenciar:</label>
        <select id="section-select" class="form-input w-full p-3" onchange="showForm(this.value)">
            <option value="upcomingGames">Próximas Reuniões</option>
            <option value="recentResults">Últimas Reuniões</option>
            <option value="news">Notícias</option>
            <option value="players">Representantes</option>
            <option value="sponsors">Apoiadores</option>
        </select>
    </div>

    <div id="forms-container">
        <div id="form-upcomingGames" class="form-section">
            <h2 class="text-2xl font-bold mb-4">Gerenciar Próximas Reuniões</h2>
            <form id="upcomingGames-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="upcomingGames-id">
                <div>
                    <label for="upcomingGames-date-input" class="block text-sm font-medium mb-1">Data da Reunião</label>
                    <input type="date" id="upcomingGames-date-input" class="form-input p-2 w-full" required>
                </div>
                <div>
                    <label for="upcomingGames-time-input" class="block text-sm font-medium mb-1">Hora da reunião</label>
                    <input type="time" id="upcomingGames-time-input" class="form-input p-2 w-full" required>
                </div>
                <input type="text" id="upcomingGames-teams" placeholder="Times (ex: Kendence vs. Time B)" class="form-input p-2 col-span-1 md:col-span-2" required>
                <input type="text" id="upcomingGames-location" placeholder="Nome do Campo" class="form-input p-2" required>
                <input type="url" id="upcomingGames-mapLink" placeholder="Link do Google Maps" class="form-input p-2" required>
                <div class="col-span-1 md:col-span-2 flex space-x-2">
                    <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                    <button type="button" onclick="clearForm('upcomingGames')" class="btn btn-secondary">Limpar</button>
                </div>
            </form>
        </div>
        <div id="form-recentResults" class="form-section hidden">
            <h2 class="text-2xl font-bold mb-4">Gerenciar Reuniões Recentes</h2>
            <form id="recentResults-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="recentResults-id">
                 <div>
                    <label for="recentResults-date-input" class="block text-sm font-medium mb-1">Data da Reunião</label>
                    <input type="date" id="recentResults-date-input" class="form-input p-2 w-full" required>
                </div>
                <div>
                    <label for="recentResults-time-input" class="block text-sm font-medium mb-1">Hora da reunião</label>
                    <input type="time" id="recentResults-time-input" class="form-input p-2 w-full" required>
                </div>
                <input type="text" id="recentResults-match" placeholder="Resultado (ex: Kendence 3 x 2 Time B)" class="form-input p-2 col-span-1 md:col-span-2" required>
                <input type="text" id="recentResults-location" placeholder="Nome do Campo" class="form-input p-2" required>
                <input type="url" id="recentResults-videoLink" placeholder="Link para Fotos/Vídeos" class="form-input p-2" required>
                <div class="col-span-1 md:col-span-2 flex space-x-2">
                    <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                    <button type="button" onclick="clearForm('recentResults')" class="btn btn-secondary">Limpar</button>
                </div>
            </form>
        </div>
        <div id="form-news" class="form-section hidden">
            <h2 class="text-2xl font-bold mb-4">Gerenciar Notícias</h2>
            <form id="news-form" class="grid grid-cols-1 gap-4">
                <input type="hidden" id="news-id">
                <input type="date" id="news-date" class="form-input p-2" required>
                <input type="text" id="news-title" placeholder="Título da Notícia" class="form-input p-2" required>
                <input type="url" id="news-image" placeholder="URL da Imagem (completa)" class="form-input p-2" required>
                <textarea id="news-text" placeholder="Texto da Notícia" rows="5" class="form-input p-2" required></textarea>
                <div class="flex space-x-2">
                    <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                    <button type="button" onclick="clearForm('news')" class="btn btn-secondary">Limpar</button>
                </div>
            </form>
        </div>
        <div id="form-players" class="form-section hidden">
            <h2 class="text-2xl font-bold mb-4">Gerenciar Representantes</h2>
            <form id="players-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="players-id">
                <input type="text" id="players-name" placeholder="Nome do representante" class="form-input p-2" required>
                 <select id="players-role" class="form-input p-2" required>
                    <option value="">Selecione a Função</option>
                    <option value="Comissão Técnica">Comissão Técnica</option>
                    <option value="Goleiros">Goleiros</option>
                    <option value="Zagueiros e Volantes">Zagueiros e Volantes</option>
                    <option value="Laterais">Laterais</option>
                    <option value="Meios">Meios</option>
                    <option value="Atacantes">Atacantes</option>
                </select>
                <input type="url" id="players-image" placeholder="URL da Foto (completa)" class="form-input p-2 col-span-1 md:col-span-2" required>
                <input type="url" id="players-instagram" placeholder="Link do Instagram" class="form-input p-2 col-span-1 md:col-span-2" required>
                <div class="col-span-1 md:col-span-2 flex space-x-2">
                    <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                    <button type="button" onclick="clearForm('players')" class="btn btn-secondary">Limpar</button>
                </div>
            </form>
        </div>
        <div id="form-sponsors" class="form-section hidden">
            <h2 class="text-2xl font-bold mb-4">Gerenciar Colaboradores</h2>
            <form id="sponsors-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="sponsors-id">
                <input type="text" id="sponsors-name" placeholder="Nome do Patrocinador" class="form-input p-2" required>
                <input type="text" id="sponsors-address" placeholder="Endereço" class="form-input p-2" required>
                <input type="tel" id="sponsors-phone" placeholder="Telefone" class="form-input p-2" required>
                <input type="url" id="sponsors-image" placeholder="URL da Logo (completa)" class="form-input p-2 col-span-1 md:col-span-2" required>
                <input type="url" id="sponsors-instagram" placeholder="Link do Instagram" class="form-input p-2 col-span-1 md:col-span-2" required>
                 <div class="col-span-1 md:col-span-2 flex space-x-2">
                    <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                    <button type="button" onclick="clearForm('sponsors')" class="btn btn-secondary">Limpar</button>
                </div>
            </form>
        </div>
    </div>
    
    <h3 class="text-2xl font-bold mb-4 mt-8">Dados Atuais</h3>
    <div id="data-display" class="space-y-2">Carregando dados...</div>
    
    <script type="module">
        // --- CORREÇÃO: ADICIONADAS TODAS AS IMPORTAÇÕES NECESSÁRIAS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
        import { getDatabase, ref, onValue, get, set, push, remove } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD1D5gRg9bkkeyVcJeizFPb24fnASueVvo",
            authDomain: "amjjk-d8656.firebaseapp.com",
            projectId: "amjjk-d8656",
            storageBucket: "amjjk-d8656.firebasestorage.app",
            messagingSenderId: "202877045569",
            appId: "1:202877045569:web:3b4f713d291ebc0185efc0",
            measurementId: "G-HCHPVET393"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        let currentSection = 'upcomingGames';

        const sections = {
            upcomingGames: { dbRef: 'upcomingGames', formId: 'upcomingGames-form' },
            recentResults: { dbRef: 'recentResults', formId: 'recentResults-form' },
            news:          { dbRef: 'news', formId: 'news-form' },
            players:       { dbRef: 'players', formId: 'players-form' },
            sponsors:      { dbRef: 'sponsors', formId: 'sponsors-form' }
        };
        
        window.showForm = (sectionName) => {
            currentSection = sectionName;
            document.querySelectorAll('.form-section').forEach(form => form.classList.add('hidden'));
            document.getElementById(`form-${sectionName}`).classList.remove('hidden');
            fetchData();
            clearForm(currentSection);
        };

        window.clearForm = (sectionName) => {
            const form = document.getElementById(sections[sectionName].formId);
            form.reset();
            document.getElementById(`${sectionName}-id`).value = '';
        };

        window.editItem = async (key) => {
            const section = sections[currentSection];
            const form = document.getElementById(section.formId);
            const snapshot = await get(ref(database, `${section.dbRef}/${key}`));
            if (!snapshot.exists()) return;
            const data = snapshot.val();
            document.getElementById(`${currentSection}-id`).value = key;
            
            Object.keys(data).forEach(field => {
                const inputId = `${currentSection}-${field}`;
                const inputElement = document.getElementById(inputId);
                if (inputElement) {
                    inputElement.value = data[field];
                }
            });

            if (data.date && (currentSection === 'upcomingGames' || currentSection === 'recentResults')) {
                const dateObj = new Date(data.date);
                document.getElementById(`${currentSection}-date-input`).value = dateObj.toISOString().split('T')[0];
                document.getElementById(`${currentSection}-time-input`).value = dateObj.toTimeString().split(' ')[0].substring(0, 5);
            }

            window.scrollTo(0, 0);
        };
        
        window.deleteItem = (key) => {
            if (confirm('Tem certeza que deseja excluir este item?')) {
                remove(ref(database, `${sections[currentSection].dbRef}/${key}`))
                    .then(() => alert('Item excluído com sucesso!'))
                    .catch(error => alert(error.message));
            }
        };
        
        window.backupData = async () => { 
            try { 
                const snapshot = await get(ref(database)); 
                if (!snapshot.exists()) { 
                    alert("Nenhum dado para fazer backup."); 
                    return; 
                } 
                const data = snapshot.val(); 
                const jsonData = JSON.stringify(data, null, 2); 
                const blob = new Blob([jsonData], { type: 'application/json' }); 
                const url = URL.createObjectURL(blob); 
                const a = document.createElement('a'); 
                a.href = url; 
                const date = new Date().toISOString().slice(0, 10); 
                a.download = `backup-amjjk-${date}.json`; 
                document.body.appendChild(a); 
                a.click(); 
                document.body.removeChild(a); 
                URL.revokeObjectURL(url); 
            } catch (error) { 
                alert("Erro ao fazer backup: " + error.message); 
            } 
        };
        window.triggerRestore = () => document.getElementById('restore-file-input').click();
        window.restoreData = (event) => { 
            const file = event.target.files[0]; 
            if (!file) return; 
            if (!confirm("ATENÇÃO: Isso irá substituir TODOS os dados atuais. Deseja continuar?")) { 
                event.target.value = ''; return; 
            } 
            const reader = new FileReader(); 
            reader.onload = (e) => { 
                try { 
                    const jsonData = JSON.parse(e.target.result); 
                    set(ref(database), jsonData)
                    .then(() => {
                        alert("Backup restaurado com sucesso! A página será recarregada.");
                        location.reload();
                    })
                    .catch(error => alert("Erro ao restaurar: " + error.message)); 
                } catch (error) { 
                    alert("Erro: O arquivo selecionado não é um JSON válido."); 
                } finally { 
                    event.target.value = ''; 
                } 
            }; 
            reader.readAsText(file); 
        };
        
        function fetchData() {
            const dataRef = ref(database, sections[currentSection].dbRef);
            const display = document.getElementById('data-display');
            display.innerHTML = 'Carregando...';
            onValue(dataRef, (snapshot) => {
                display.innerHTML = '';
                const data = snapshot.val();
                if (data) {
                    let items = Object.entries(data);
                    if (items.length > 0 && items[0][1].date) {
                        items.sort(([, a], [, b]) => new Date(b.date) - new Date(a.date));
                    }
                    items.forEach(([key, item]) => {
                        const title = item.title || item.teams || item.match || item.name;
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'bg-gray-700 p-3 rounded flex justify-between items-center';
                        itemDiv.innerHTML = `<span>${title}</span><div><button onclick="editItem('${key}')" class="btn btn-secondary py-1 px-2 text-sm mr-2">Editar</button><button onclick="deleteItem('${key}')" class="btn btn-danger py-1 px-2 text-sm">Excluir</button></div>`;
                        display.appendChild(itemDiv);
                    });
                } else {
                    display.innerHTML = '<p>Nenhum dado encontrado.</p>';
                }
            });
        }
        
        function handleFormSubmit(event) {
            event.preventDefault();
            const section = sections[currentSection];
            const form = event.target;
            const id = document.getElementById(`${currentSection}-id`).value;
            const data = {};
            
            for (const element of form.elements) {
                if (element.type !== "submit" && element.type !== "button" && element.id && !element.id.includes('-input')) {
                   const key = element.id.replace(`${currentSection}-`, '');
                   data[key] = element.value;
                }
            }
            
            if (currentSection === 'upcomingGames' || currentSection === 'recentResults') {
                const dateValue = document.getElementById(`${currentSection}-date-input`).value;
                const timeValue = document.getElementById(`${currentSection}-time-input`).value;
                if (dateValue && timeValue) {
                    data.date = new Date(`${dateValue}T${timeValue}`).toISOString();
                }
            }

            const dbRef = id ? ref(database, `${section.dbRef}/${id}`) : push(ref(database, section.dbRef));
            set(dbRef, data)
              .then(() => {
                  alert(`Dados ${id ? 'atualizados' : 'adicionados'} com sucesso!`);
                  clearForm(currentSection);
              })
              .catch(error => alert(error.message));
        }
        
        window.onload = () => {
            Object.keys(sections).forEach(key => {
                document.getElementById(sections[key].formId).addEventListener('submit', handleFormSubmit);
            });
            showForm(currentSection);
        };
    </script>
</body>
</html>
